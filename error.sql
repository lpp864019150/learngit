# 线上有bug sql
SELECT FROM_UNIXTIME(lo.create_time,'%Y-%m-%d') AS `day`, `et`.`warehouse_id` AS `warehouse`, `lp`.`sku` AS `sku`, `p`.`customer_price_type` AS `customer_price_type`, SUM(1) AS `total_count`, SUM(IF(tagSd.trade_id>0, 0, 1)) AS `no_swipe_order_count`, SUM(IF(tagSd.trade_id>0 OR tagClose.trade_id>0 OR tagService.trade_id>0 OR tagServiceOrder.trade_id>0, 0, IF((t.status NOT IN (1, 5) OR t.consign_time>0) OR (lo.is_relate=0 AND lo.order_status NOT IN(1,4) AND lo.after_sale_status=-1), 1, 0))) AS `valid_order_count`, SUM(IF(tagSd.trade_id>0 OR tagClose.trade_id>0 OR tagService.trade_id>0 OR tagServiceOrder.trade_id>0, 0, IF(lo.logistics_time>0, 1, 0))) AS `shipped_order_count`, SUM(IF(tagSd.trade_id>0 OR tagClose.trade_id>0 OR tagService.trade_id>0 OR tagServiceOrder.trade_id>0, 0, IF(lo.logistics_time=0 AND tagJd.trade_id>0, 1, 0))) AS `over_part_order_count`, SUM(IF(tagSd.trade_id>0 OR tagClose.trade_id>0 OR tagService.trade_id>0 OR tagServiceOrder.trade_id>0, 0, IF(lo.order_status=2, 1, 0))) AS `waiting_send_order_count`, SUM(IF(tagSd.trade_id>0, 0, IF( (lo.logistics_time=0 AND (lo.offline_refund_amount + lo.online_refund_amount)>0), 1, 0))) AS `pre_sale_refund_order_count`, SUM(IF(tagSd.trade_id>0, 0, IF( (lo.logistics_time>0 AND (lo.offline_refund_amount + lo.online_refund_amount)>0), 1, 0))) AS `after_sale_refund_order_count`, SUM(IF(tagSd.trade_id>0 OR tagClose.trade_id>0 OR tagService.trade_id>0 OR tagServiceOrder.trade_id>0, 0, IF(lo.after_sale_type != -1, 1, 0))) AS `after_sale_refund_apply_order_count`, SUM(IF(tagSd.trade_id>0 OR tagClose.trade_id>0 OR tagService.trade_id>0 OR tagServiceOrder.trade_id>0, 0, IF(t.sign_time=0 AND lo.after_sale_type != -1, 1, 0))) AS `unsign_after_sale_refund_order_count`, SUM(IF(tagSd.trade_id>0 OR tagClose.trade_id>0 OR tagService.trade_id>0 OR tagServiceOrder.trade_id>0, 0, IF(lo.is_comment>0, 1, 0))) AS `comment_order_count`, SUM(IF(tagSd.trade_id>0 OR tagClose.trade_id>0 OR tagService.trade_id>0 OR tagServiceOrder.trade_id>0, 0, IF((t.status NOT IN (1, 5) OR t.consign_time>0) OR (lo.is_relate=0 AND lo.order_status NOT IN(1,4) AND lo.after_sale_status=-1), lo.total_amount, 0))) AS `valid_fee`, SUM(IF(tagSd.trade_id>0, 0, IF(lo.logistics_time=0 AND (lo.offline_refund_amount + lo.online_refund_amount)>0, lo.offline_refund_amount + lo.online_refund_amount, 0))) AS `pre_sale_refund_fee_1`, SUM(0) AS `pre_sale_refund_fee_2`, SUM(IF(tagSd.trade_id>0 OR tagClose.trade_id>0 OR tagService.trade_id>0 OR tagServiceOrder.trade_id>0, 0, IF((lo.order_status=4 AND lo.after_sale_type IN (0,1,3)) OR (lo.order_status=5), lo.total_amount, 0))) AS `finish_order_fee` FROM `luban_order` `lo` LEFT JOIN `trade` `t` ON t.trade_id=lo.ec_trade_id LEFT JOIN `trade_tag` `tagSd` ON tagSd.trade_id=t.id and tagSd.tag_id=426 LEFT JOIN `trade_tag` `tagClose` ON tagClose.trade_id=t.id and tagClose.tag_id=1039 LEFT JOIN `trade_tag` `tagService` ON tagService.trade_id=t.id and tagService.tag_id=1037 LEFT JOIN `trade_tag` `tagServiceOrder` ON tagServiceOrder.trade_id=t.id and tagServiceOrder.tag_id=1050 LEFT JOIN `trade_tag` `tagJd` ON tagJd.trade_id=t.id and tagJd.tag_id=452 LEFT JOIN `express_trade` `et` ON et.trade_id=lo.ec_trade_id LEFT JOIN `luban_order_product` `lop` ON lop.order_id=lo.id LEFT JOIN `luban_product` `lp` ON lp.id=lop.luban_product_id LEFT JOIN `product` `p` ON p.id=lp.ec_product_id WHERE (lo.create_time BETWEEN 1625068800 AND 1627747199) AND (`et`.`warehouse` IN (14, 23, 26)) GROUP BY `day`, `warehouse`, `sku`, `customer_price_type`;


错误信息，不要提交

